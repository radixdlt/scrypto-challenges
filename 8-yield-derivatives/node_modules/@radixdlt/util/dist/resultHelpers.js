"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.flattenResultsObject = void 0;
const neverthrow_1 = require("neverthrow");
const typeGuards_1 = require("./typeGuards");
const unwrap = (maybeResult, errors) => {
    if (typeGuards_1.isResult(maybeResult)) {
        if (maybeResult.isOk()) {
            const value = maybeResult.value;
            if (typeGuards_1.isResult(value)) {
                return unwrap(value, errors);
            }
            return value;
        }
        else {
            errors.push(maybeResult.error);
            return maybeResult;
        }
    }
    return maybeResult;
};
const flattenResultsObject = (json) => {
    const errors = [];
    const flattened = json
        .map(value => {
        if (!typeGuards_1.isObject(value))
            return value;
        for (const item in value) {
            const objValue = value[item];
            if (objValue && typeGuards_1.isResult(objValue)) {
                const res = exports.flattenResultsObject(objValue);
                value[item] = unwrap(res, errors);
            }
        }
        return value;
    })
        .mapErr(err => {
        errors.push(err);
        return errors.flat();
    });
    return errors.length > 0 ? neverthrow_1.err(errors.flat()) : flattened;
};
exports.flattenResultsObject = flattenResultsObject;
//# sourceMappingURL=resultHelpers.js.map