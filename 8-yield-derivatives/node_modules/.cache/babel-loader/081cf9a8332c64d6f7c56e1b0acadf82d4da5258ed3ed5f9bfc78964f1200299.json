{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TransportRequestManager = void 0;\nvar events_1 = require(\"events\");\nvar Error_1 = require(\"../Error\");\nvar TransportRequestManager = /** @class */function () {\n  function TransportRequestManager() {\n    this.pendingRequest = {};\n    this.pendingBatchRequest = {};\n    this.transportEventChannel = new events_1.EventEmitter();\n  }\n  TransportRequestManager.prototype.addRequest = function (data, timeout) {\n    this.transportEventChannel.emit(\"pending\", data);\n    if (data instanceof Array) {\n      this.addBatchReq(data, timeout);\n      return Promise.resolve();\n    }\n    return this.addReq(data.internalID, timeout);\n  };\n  TransportRequestManager.prototype.settlePendingRequest = function (request, error) {\n    var _this = this;\n    request.forEach(function (req) {\n      var resolver = _this.pendingRequest[req.internalID];\n      delete _this.pendingBatchRequest[req.internalID];\n      if (resolver === undefined) {\n        return;\n      }\n      if (error) {\n        resolver.reject(error);\n        return;\n      }\n      resolver.resolve();\n    });\n  };\n  TransportRequestManager.prototype.resolveResponse = function (payload, emitError) {\n    if (emitError === void 0) {\n      emitError = true;\n    }\n    var data = payload;\n    try {\n      data = JSON.parse(payload);\n      if (this.checkJSONRPC(data) === false) {\n        throw new Error(\"Bad response format\");\n      }\n      if (data instanceof Array) {\n        return this.resolveBatch(data, emitError);\n      }\n      return this.resolveRes(data, emitError);\n    } catch (e) {\n      var err = new Error_1.JSONRPCError(\"Bad response format\", Error_1.ERR_UNKNOWN, payload);\n      if (emitError) {\n        this.transportEventChannel.emit(\"error\", err);\n      }\n      return err;\n    }\n  };\n  TransportRequestManager.prototype.addBatchReq = function (batches, timeout) {\n    var _this = this;\n    batches.forEach(function (batch) {\n      var resolve = batch.resolve,\n        reject = batch.reject;\n      var internalID = batch.request.internalID;\n      _this.pendingBatchRequest[internalID] = true;\n      _this.pendingRequest[internalID] = {\n        resolve: resolve,\n        reject: reject\n      };\n    });\n    return Promise.resolve();\n  };\n  TransportRequestManager.prototype.addReq = function (id, timeout) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      if (timeout !== null && timeout) {\n        _this.setRequestTimeout(id, timeout, reject);\n      }\n      _this.pendingRequest[id] = {\n        resolve: resolve,\n        reject: reject\n      };\n    });\n  };\n  TransportRequestManager.prototype.checkJSONRPC = function (data) {\n    var payload = [data];\n    if (data instanceof Array) {\n      payload = data;\n    }\n    return payload.every(function (datum) {\n      return datum.result !== undefined || datum.error !== undefined || datum.method !== undefined;\n    });\n  };\n  TransportRequestManager.prototype.processResult = function (payload, prom) {\n    if (payload.error) {\n      var err = Error_1.convertJSONToRPCError(payload);\n      prom.reject(err);\n      return;\n    }\n    prom.resolve(payload.result);\n  };\n  TransportRequestManager.prototype.resolveBatch = function (payload, emitError) {\n    var _this = this;\n    var results = payload.map(function (datum) {\n      return _this.resolveRes(datum, emitError);\n    });\n    var errors = results.filter(function (result) {\n      return result;\n    });\n    if (errors.length > 0) {\n      return errors[0];\n    }\n    return undefined;\n  };\n  TransportRequestManager.prototype.resolveRes = function (data, emitError) {\n    var id = data.id,\n      error = data.error;\n    var status = this.pendingRequest[id];\n    if (status) {\n      delete this.pendingRequest[id];\n      this.processResult(data, status);\n      this.transportEventChannel.emit(\"response\", data);\n      return;\n    }\n    if (id === undefined && error === undefined) {\n      this.transportEventChannel.emit(\"notification\", data);\n      return;\n    }\n    var err;\n    if (error) {\n      err = Error_1.convertJSONToRPCError(data);\n    }\n    if (emitError && error && err) {\n      this.transportEventChannel.emit(\"error\", err);\n    }\n    return err;\n  };\n  TransportRequestManager.prototype.setRequestTimeout = function (id, timeout, reject) {\n    var _this = this;\n    setTimeout(function () {\n      delete _this.pendingRequest[id];\n      reject(new Error_1.JSONRPCError(\"Request timeout request took longer than \" + timeout + \" ms to resolve\", Error_1.ERR_TIMEOUT));\n    }, timeout);\n  };\n  return TransportRequestManager;\n}();\nexports.TransportRequestManager = TransportRequestManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","TransportRequestManager","events_1","require","Error_1","pendingRequest","pendingBatchRequest","transportEventChannel","EventEmitter","prototype","addRequest","data","timeout","emit","Array","addBatchReq","Promise","resolve","addReq","internalID","settlePendingRequest","request","error","_this","forEach","req","resolver","undefined","reject","resolveResponse","payload","emitError","JSON","parse","checkJSONRPC","Error","resolveBatch","resolveRes","e","err","JSONRPCError","ERR_UNKNOWN","batches","batch","id","setRequestTimeout","every","datum","result","method","processResult","prom","convertJSONToRPCError","results","map","errors","filter","length","status","setTimeout","ERR_TIMEOUT"],"sources":["/Users/mdabdurrazzak/RadInsu/node_modules/@open-rpc/client-js/build/transports/TransportRequestManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransportRequestManager = void 0;\nvar events_1 = require(\"events\");\nvar Error_1 = require(\"../Error\");\nvar TransportRequestManager = /** @class */ (function () {\n    function TransportRequestManager() {\n        this.pendingRequest = {};\n        this.pendingBatchRequest = {};\n        this.transportEventChannel = new events_1.EventEmitter();\n    }\n    TransportRequestManager.prototype.addRequest = function (data, timeout) {\n        this.transportEventChannel.emit(\"pending\", data);\n        if (data instanceof Array) {\n            this.addBatchReq(data, timeout);\n            return Promise.resolve();\n        }\n        return this.addReq(data.internalID, timeout);\n    };\n    TransportRequestManager.prototype.settlePendingRequest = function (request, error) {\n        var _this = this;\n        request.forEach(function (req) {\n            var resolver = _this.pendingRequest[req.internalID];\n            delete _this.pendingBatchRequest[req.internalID];\n            if (resolver === undefined) {\n                return;\n            }\n            if (error) {\n                resolver.reject(error);\n                return;\n            }\n            resolver.resolve();\n        });\n    };\n    TransportRequestManager.prototype.resolveResponse = function (payload, emitError) {\n        if (emitError === void 0) { emitError = true; }\n        var data = payload;\n        try {\n            data = JSON.parse(payload);\n            if (this.checkJSONRPC(data) === false) {\n                throw new Error(\"Bad response format\");\n            }\n            if (data instanceof Array) {\n                return this.resolveBatch(data, emitError);\n            }\n            return this.resolveRes(data, emitError);\n        }\n        catch (e) {\n            var err = new Error_1.JSONRPCError(\"Bad response format\", Error_1.ERR_UNKNOWN, payload);\n            if (emitError) {\n                this.transportEventChannel.emit(\"error\", err);\n            }\n            return err;\n        }\n    };\n    TransportRequestManager.prototype.addBatchReq = function (batches, timeout) {\n        var _this = this;\n        batches.forEach(function (batch) {\n            var resolve = batch.resolve, reject = batch.reject;\n            var internalID = batch.request.internalID;\n            _this.pendingBatchRequest[internalID] = true;\n            _this.pendingRequest[internalID] = { resolve: resolve, reject: reject };\n        });\n        return Promise.resolve();\n    };\n    TransportRequestManager.prototype.addReq = function (id, timeout) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            if (timeout !== null && timeout) {\n                _this.setRequestTimeout(id, timeout, reject);\n            }\n            _this.pendingRequest[id] = { resolve: resolve, reject: reject };\n        });\n    };\n    TransportRequestManager.prototype.checkJSONRPC = function (data) {\n        var payload = [data];\n        if (data instanceof Array) {\n            payload = data;\n        }\n        return payload.every(function (datum) { return (datum.result !== undefined || datum.error !== undefined || datum.method !== undefined); });\n    };\n    TransportRequestManager.prototype.processResult = function (payload, prom) {\n        if (payload.error) {\n            var err = Error_1.convertJSONToRPCError(payload);\n            prom.reject(err);\n            return;\n        }\n        prom.resolve(payload.result);\n    };\n    TransportRequestManager.prototype.resolveBatch = function (payload, emitError) {\n        var _this = this;\n        var results = payload.map(function (datum) {\n            return _this.resolveRes(datum, emitError);\n        });\n        var errors = results.filter(function (result) { return result; });\n        if (errors.length > 0) {\n            return errors[0];\n        }\n        return undefined;\n    };\n    TransportRequestManager.prototype.resolveRes = function (data, emitError) {\n        var id = data.id, error = data.error;\n        var status = this.pendingRequest[id];\n        if (status) {\n            delete this.pendingRequest[id];\n            this.processResult(data, status);\n            this.transportEventChannel.emit(\"response\", data);\n            return;\n        }\n        if (id === undefined && error === undefined) {\n            this.transportEventChannel.emit(\"notification\", data);\n            return;\n        }\n        var err;\n        if (error) {\n            err = Error_1.convertJSONToRPCError(data);\n        }\n        if (emitError && error && err) {\n            this.transportEventChannel.emit(\"error\", err);\n        }\n        return err;\n    };\n    TransportRequestManager.prototype.setRequestTimeout = function (id, timeout, reject) {\n        var _this = this;\n        setTimeout(function () {\n            delete _this.pendingRequest[id];\n            reject(new Error_1.JSONRPCError(\"Request timeout request took longer than \" + timeout + \" ms to resolve\", Error_1.ERR_TIMEOUT));\n        }, timeout);\n    };\n    return TransportRequestManager;\n}());\nexports.TransportRequestManager = TransportRequestManager;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}