{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar axios_1 = tslib_1.__importDefault(require(\"axios\"));\nvar atommodel_1 = require(\"../atommodel\");\nvar __1 = require(\"../..\");\n/**\n * Node discovery from the Radix bootstrap service\n */\nvar RadixNodeDiscoveryFromNodeFinder = /** @class */function () {\n  /**\n   * Creates an instance of radix node discovery from node finder.\n   * @param bootstrapService The full address to the node finder service for the universe\n   */\n  function RadixNodeDiscoveryFromNodeFinder(bootstrapService, wsAddress, httpAddress) {\n    this.bootstrapService = bootstrapService;\n    this.wsAddress = wsAddress;\n    this.httpAddress = httpAddress;\n  }\n  RadixNodeDiscoveryFromNodeFinder.prototype.loadNodes = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var bootstrapNodeIP, bootstrapNode, getPeersRequestData, nodeListResponse, nodeList;\n      var _this = this;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, axios_1.default.get(this.bootstrapService)];\n          case 1:\n            bootstrapNodeIP = _a.sent().data;\n            if (bootstrapNodeIP.length < 2) {\n              throw new Error('Failed to get node list from bootstrap service');\n            }\n            bootstrapNode = this.httpAddress(bootstrapNodeIP, 0);\n            getPeersRequestData = {\n              id: 0,\n              method: 'Network.getLivePeers',\n              params: []\n            };\n            return [4 /*yield*/, axios_1.default.post(bootstrapNode, getPeersRequestData)];\n          case 2:\n            nodeListResponse = _a.sent();\n            nodeList = atommodel_1.RadixSerializer.fromJSON(nodeListResponse.data.result);\n            if (nodeList.length === 0) {\n              throw new Error('Bootstrap node has no connections');\n            }\n            return [2 /*return*/, nodeList.map(function (peerInfo) {\n              return new __1.RadixNode(peerInfo.system, _this.wsAddress(peerInfo.host.ip, peerInfo.host.port), _this.httpAddress(peerInfo.host.ip, peerInfo.host.port));\n            })];\n        }\n      });\n    });\n  };\n  return RadixNodeDiscoveryFromNodeFinder;\n}();\nexports.default = RadixNodeDiscoveryFromNodeFinder;","map":{"version":3,"names":["axios_1","tslib_1","__importDefault","require","atommodel_1","__1","RadixNodeDiscoveryFromNodeFinder","bootstrapService","wsAddress","httpAddress","prototype","loadNodes","default","get","bootstrapNodeIP","_a","sent","data","length","Error","bootstrapNode","getPeersRequestData","id","method","params","post","nodeListResponse","nodeList","RadixSerializer","fromJSON","result","map","peerInfo","RadixNode","system","_this","host","ip","port"],"sources":["../../../../src/modules/universe/RadixNodeDiscoveryFromNodeFinder.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA,CAAAC,eAAA,CAAAC,OAAA;AAIA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,GAAA,GAAAF,OAAA;AAEA;;;AAGA,IAAAG,gCAAA;EAEI;;;;EAIA,SAAAA,iCACaC,gBAAwB,EACxBC,SAAiD,EACjDC,WAAmD;IAFnD,KAAAF,gBAAgB,GAAhBA,gBAAgB;IAChB,KAAAC,SAAS,GAATA,SAAS;IACT,KAAAC,WAAW,GAAXA,WAAW;EAA2C;EAEtDH,gCAAA,CAAAI,SAAA,CAAAC,SAAS,GAAtB;;;;;;;YAC6B,qBAAMX,OAAA,CAAAY,OAAK,CAACC,GAAG,CAAC,IAAI,CAACN,gBAAgB,CAAC;;YAAzDO,eAAe,GAAIC,EAAA,CAAAC,IAAA,EAAsC,CAAEC,IAAI;YACrE,IAAIH,eAAe,CAACI,MAAM,GAAG,CAAC,EAAE;cAC5B,MAAM,IAAIC,KAAK,CAAC,gDAAgD,CAAC;;YAE/DC,aAAa,GAAG,IAAI,CAACX,WAAW,CAACK,eAAe,EAAE,CAAC,CAAC;YAEpDO,mBAAmB,GAAG;cACxBC,EAAE,EAAE,CAAC;cACLC,MAAM,EAAE,sBAAsB;cAC9BC,MAAM,EAAE;aACX;YACwB,qBAAMxB,OAAA,CAAAY,OAAK,CAACa,IAAI,CACrCL,aAAa,EACbC,mBAAmB,CACtB;;YAHKK,gBAAgB,GAAGX,EAAA,CAAAC,IAAA,EAGxB;YAEKW,QAAQ,GAAgBvB,WAAA,CAAAwB,eAAe,CAACC,QAAQ,CAACH,gBAAgB,CAACT,IAAI,CAACa,MAAM,CAAC;YAEpF,IAAIH,QAAQ,CAACT,MAAM,KAAK,CAAC,EAAE;cACvB,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;;YAGxD,sBAAOQ,QAAQ,CAACI,GAAG,CAAC,UAACC,QAAQ;cACzB,OAAO,IAAI3B,GAAA,CAAA4B,SAAS,CAACD,QAAQ,CAACE,MAAM,EAChCC,KAAI,CAAC3B,SAAS,CAACwB,QAAQ,CAACI,IAAI,CAACC,EAAE,EAAEL,QAAQ,CAACI,IAAI,CAACE,IAAI,CAAC,EACpDH,KAAI,CAAC1B,WAAW,CAACuB,QAAQ,CAACI,IAAI,CAACC,EAAE,EAAEL,QAAQ,CAACI,IAAI,CAACE,IAAI,CAAC,CAAC;YAC/D,CAAC,CAAC;;;;GACL;EACL,OAAAhC,gCAAC;AAAD,CAAC,CAxCD","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}