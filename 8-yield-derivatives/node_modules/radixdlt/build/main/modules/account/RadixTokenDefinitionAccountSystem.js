"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var typescript_map_1 = require("typescript-map");
var rxjs_1 = require("rxjs");
var operators_1 = require("rxjs/operators");
var RadixTokenDefinition_1 = require("../token/RadixTokenDefinition");
var atommodel_1 = require("../atommodel");
var RadixTokenDefinitionAccountSystem = /** @class */ (function () {
    function RadixTokenDefinitionAccountSystem(address) {
        this.address = address;
        this.name = 'TOKENS';
        this.tokenDefinitions = new typescript_map_1.TSMap();
        this.tokenDefinitionSubject = new rxjs_1.Subject();
        this.processedAtomHIDs = new typescript_map_1.TSMap();
        // Empty constructor
    }
    RadixTokenDefinitionAccountSystem.prototype.processAtomUpdate = function (atomUpdate) {
        if (!atomUpdate.atom.containsParticle(atommodel_1.RadixTokenDefinitionParticle, atommodel_1.RadixUnallocatedTokensParticle)) {
            return;
        }
        if (atomUpdate.action === 'STORE') {
            this.processStoreAtom(atomUpdate);
        }
        else if (atomUpdate.action === 'DELETE') {
            this.processDeleteAtom(atomUpdate);
        }
    };
    RadixTokenDefinitionAccountSystem.prototype.processStoreAtom = function (atomUpdate) {
        var e_1, _a, e_2, _b, e_3, _c;
        var atom = atomUpdate.atom;
        if (this.processedAtomHIDs.has(atom.getAidString())) {
            return;
        }
        this.processedAtomHIDs.set(atom.getAidString(), true);
        try {
            for (var _d = tslib_1.__values(atom.getParticleGroups()), _e = _d.next(); !_e.done; _e = _d.next()) {
                var particleGroup = _e.value;
                var tokenDefinition = void 0;
                if (particleGroup.containsParticle(atommodel_1.RadixTokenDefinitionParticle)) {
                    try {
                        // Token definition
                        for (var _f = (e_2 = void 0, tslib_1.__values(particleGroup.getParticles())), _g = _f.next(); !_g.done; _g = _f.next()) {
                            var spunParticle = _g.value;
                            if (spunParticle.particle instanceof atommodel_1.RadixTokenDefinitionParticle && spunParticle.spin === atommodel_1.RadixSpin.UP) {
                                this.createOrUpdateTokenDefinition(spunParticle.particle);
                            }
                            else if (spunParticle.particle instanceof atommodel_1.RadixUnallocatedTokensParticle) {
                                var particle = spunParticle.particle;
                                tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                                if (spunParticle.spin === atommodel_1.RadixSpin.UP) {
                                    tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                                }
                                else {
                                    tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                                }
                            }
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
                else if (particleGroup.containsParticle(atommodel_1.RadixUnallocatedTokensParticle)
                    && particleGroup.containsParticle(atommodel_1.RadixTransferrableTokensParticle)) {
                    try {
                        // Mint or burn
                        for (var _h = (e_3 = void 0, tslib_1.__values(particleGroup.getParticles())), _j = _h.next(); !_j.done; _j = _h.next()) {
                            var spunParticle = _j.value;
                            if (spunParticle.particle instanceof atommodel_1.RadixUnallocatedTokensParticle) {
                                var particle = spunParticle.particle;
                                tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                                if (spunParticle.spin === atommodel_1.RadixSpin.UP) {
                                    tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                                    tokenDefinition.addTotalSupply(particle.getAmount().neg());
                                }
                                else {
                                    tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                                    tokenDefinition.addTotalSupply(particle.getAmount());
                                }
                            }
                        }
                    }
                    catch (e_3_1) { e_3 = { error: e_3_1 }; }
                    finally {
                        try {
                            if (_j && !_j.done && (_c = _h.return)) _c.call(_h);
                        }
                        finally { if (e_3) throw e_3.error; }
                    }
                }
                if (tokenDefinition) {
                    this.tokenDefinitionSubject.next(tokenDefinition);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    RadixTokenDefinitionAccountSystem.prototype.processDeleteAtom = function (atomUpdate) {
        var e_4, _a, e_5, _b, e_6, _c;
        var atom = atomUpdate.atom;
        if (!this.processedAtomHIDs.has(atom.getAidString())) {
            return;
        }
        this.processedAtomHIDs.delete(atom.getAidString());
        try {
            for (var _d = tslib_1.__values(atom.getParticleGroups()), _e = _d.next(); !_e.done; _e = _d.next()) {
                var particleGroup = _e.value;
                var tokenDefinition = void 0;
                if (particleGroup.containsParticle(atommodel_1.RadixTokenDefinitionParticle)) {
                    try {
                        // Token definition
                        for (var _f = (e_5 = void 0, tslib_1.__values(particleGroup.getParticles())), _g = _f.next(); !_g.done; _g = _f.next()) {
                            var spunParticle = _g.value;
                            if (spunParticle.particle instanceof atommodel_1.RadixTokenDefinitionParticle && spunParticle.spin === atommodel_1.RadixSpin.DOWN) {
                                this.createOrUpdateTokenDefinition(spunParticle.particle);
                            }
                            else if (spunParticle.particle instanceof atommodel_1.RadixUnallocatedTokensParticle) {
                                var particle = spunParticle.particle;
                                tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                                if (spunParticle.spin === atommodel_1.RadixSpin.DOWN) {
                                    tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                                }
                                else {
                                    tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                                }
                            }
                        }
                    }
                    catch (e_5_1) { e_5 = { error: e_5_1 }; }
                    finally {
                        try {
                            if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
                        }
                        finally { if (e_5) throw e_5.error; }
                    }
                }
                else if (particleGroup.containsParticle(atommodel_1.RadixUnallocatedTokensParticle)
                    && particleGroup.containsParticle(atommodel_1.RadixTransferrableTokensParticle)) {
                    try {
                        // Mint or burn
                        for (var _h = (e_6 = void 0, tslib_1.__values(particleGroup.getParticles())), _j = _h.next(); !_j.done; _j = _h.next()) {
                            var spunParticle = _j.value;
                            if (spunParticle.particle instanceof atommodel_1.RadixUnallocatedTokensParticle) {
                                var particle = spunParticle.particle;
                                tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                                if (spunParticle.spin === atommodel_1.RadixSpin.DOWN) {
                                    tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                                    tokenDefinition.addTotalSupply(particle.getAmount().neg());
                                }
                                else {
                                    tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                                    tokenDefinition.addTotalSupply(particle.getAmount());
                                }
                            }
                        }
                    }
                    catch (e_6_1) { e_6 = { error: e_6_1 }; }
                    finally {
                        try {
                            if (_j && !_j.done && (_c = _h.return)) _c.call(_h);
                        }
                        finally { if (e_6) throw e_6.error; }
                    }
                }
                if (tokenDefinition) {
                    this.tokenDefinitionSubject.next(tokenDefinition);
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_4) throw e_4.error; }
        }
    };
    RadixTokenDefinitionAccountSystem.prototype.createOrUpdateTokenDefinition = function (particle) {
        var reference = particle.getTokenDefinitionReference();
        var tokenDefinition = this.getOrCreateTokenDefinition(reference);
        tokenDefinition.symbol = reference.getName();
        tokenDefinition.name = particle.name;
        tokenDefinition.description = particle.description;
        tokenDefinition.granularity = particle.granularity;
        tokenDefinition.iconUrl = particle.iconUrl;
        var mintPermissions = particle.permissions.mint;
        if (mintPermissions === atommodel_1.RadixTokenPermissionsValues.TOKEN_CREATION_ONLY || mintPermissions === atommodel_1.RadixTokenPermissionsValues.NONE) {
            tokenDefinition.tokenSupplyType = RadixTokenDefinition_1.RadixTokenSupplyType.FIXED;
        }
        else if (mintPermissions === atommodel_1.RadixTokenPermissionsValues.TOKEN_OWNER_ONLY || mintPermissions === atommodel_1.RadixTokenPermissionsValues.ALL) {
            tokenDefinition.tokenSupplyType = RadixTokenDefinition_1.RadixTokenSupplyType.MUTABLE;
        }
        else {
            throw new Error("Token particle with MINT permissions " + mintPermissions + " not supported");
        }
        this.tokenDefinitionSubject.next(tokenDefinition);
    };
    RadixTokenDefinitionAccountSystem.prototype.getOrCreateTokenDefinition = function (reference) {
        if (!this.tokenDefinitions.has(reference.getName())) {
            this.tokenDefinitions.set(reference.getName(), new RadixTokenDefinition_1.RadixTokenDefinition(reference.address, reference.getName()));
        }
        return this.tokenDefinitions.get(reference.getName());
    };
    RadixTokenDefinitionAccountSystem.prototype.getTokenDefinition = function (symbol) {
        if (this.tokenDefinitions.has(symbol)) {
            return this.tokenDefinitions.get(symbol);
        }
        return null;
    };
    // Subscribe for symbol
    RadixTokenDefinitionAccountSystem.prototype.getTokenDefinitionObservable = function (symbol) {
        var _this = this;
        return rxjs_1.Observable.create(function (observer) {
            if (_this.tokenDefinitions.has(symbol)) {
                observer.next(_this.tokenDefinitions.get(symbol));
            }
            _this.tokenDefinitionSubject
                .pipe(operators_1.filter(function (x) { return x.symbol === symbol; }))
                .subscribe(observer);
        });
    };
    RadixTokenDefinitionAccountSystem.prototype.getAllTokenDefinitionObservable = function () {
        return this.tokenDefinitionSubject.share();
    };
    return RadixTokenDefinitionAccountSystem;
}());
exports.RadixTokenDefinitionAccountSystem = RadixTokenDefinitionAccountSystem;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhUb2tlbkRlZmluaXRpb25BY2NvdW50U3lzdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvYWNjb3VudC9SYWRpeFRva2VuRGVmaW5pdGlvbkFjY291bnRTeXN0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQXNDO0FBQ3RDLDZCQUE4QztBQUM5Qyw0Q0FBdUM7QUFLdkMsc0VBQTBGO0FBQzFGLDBDQVFxQjtBQUVyQjtJQVNJLDJDQUFxQixPQUFxQjtRQUFyQixZQUFPLEdBQVAsT0FBTyxDQUFjO1FBUm5DLFNBQUksR0FBRyxRQUFRLENBQUE7UUFFZixxQkFBZ0IsR0FBRyxJQUFJLHNCQUFLLEVBQWdDLENBQUE7UUFFM0QsMkJBQXNCLEdBQWtDLElBQUksY0FBTyxFQUFFLENBQUE7UUFDckUsc0JBQWlCLEdBQUcsSUFBSSxzQkFBSyxFQUFtQixDQUFBO1FBSXBELG9CQUFvQjtJQUN4QixDQUFDO0lBRU0sNkRBQWlCLEdBQXhCLFVBQXlCLFVBQTJCO1FBQ2hELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHdDQUE0QixFQUFFLDBDQUE4QixDQUFDLEVBQUU7WUFDakcsT0FBTTtTQUNUO1FBRUQsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLE9BQU8sRUFBRTtZQUMvQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUE7U0FDcEM7YUFBTSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssUUFBUSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQTtTQUNyQztJQUNMLENBQUM7SUFFTSw0REFBZ0IsR0FBdkIsVUFBd0IsVUFBMkI7O1FBQy9DLElBQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUE7UUFFNUIsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FB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