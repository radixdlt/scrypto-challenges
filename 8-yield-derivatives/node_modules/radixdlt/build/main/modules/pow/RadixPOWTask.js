"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var RadixPOW_1 = tslib_1.__importDefault(require("./RadixPOW"));
var RadixPOWTask = /** @class */ (function () {
    function RadixPOWTask(magic, seed, target) {
        this.magic = magic;
        this.seed = seed;
        this.target = target;
        this.pow = new RadixPOW_1.default(magic, seed);
    }
    RadixPOWTask.prototype.computePow = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.attemptPow(resolve);
        });
    };
    RadixPOWTask.prototype.attemptPow = function (callback) {
        var _this = this;
        for (var i = 0; i < 1000; i++) {
            this.pow.incrementNonce();
            var hash = this.pow.getHash();
            if (this.meetsTarget(hash)) {
                setTimeout(function () {
                    callback(_this.pow);
                });
                return;
            }
        }
        // Non-blocking
        setTimeout(function () {
            _this.attemptPow(callback);
        }, 0);
    };
    RadixPOWTask.prototype.meetsTarget = function (hash) {
        return hash.compare(this.target) < 0;
    };
    return RadixPOWTask;
}());
exports.default = RadixPOWTask;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhQT1dUYXNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvcG93L1JhZGl4UE9XVGFzay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxnRUFBaUM7QUFJakM7SUFHSSxzQkFDYSxLQUFhLEVBQ2IsSUFBWSxFQUNaLE1BQWM7UUFGZCxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNaLFdBQU0sR0FBTixNQUFNLENBQVE7UUFFdkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLGtCQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFTSxpQ0FBVSxHQUFqQjtRQUFBLGlCQUlDO1FBSEcsT0FBTyxJQUFJLE9BQU8sQ0FBVyxVQUFDLE9BQU8sRUFBRSxNQUFNO1lBQ3pDLEtBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDNUIsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0lBSU0saUNBQVUsR0FBakIsVUFBa0IsUUFBaUM7UUFBbkQsaUJBa0JDO1FBakJHLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQTtZQUN6QixJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFBO1lBRS9CLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDeEIsVUFBVSxDQUFDO29CQUNQLFFBQVEsQ0FBQyxLQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7Z0JBQ3RCLENBQUMsQ0FBQyxDQUFBO2dCQUVGLE9BQU07YUFDVDtTQUNKO1FBRUQsZUFBZTtRQUNmLFVBQVUsQ0FBQztZQUNQLEtBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDN0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ1QsQ0FBQztJQUVNLGtDQUFXLEdBQWxCLFVBQW1CLElBQVk7UUFDM0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDeEMsQ0FBQztJQUNMLG1CQUFDO0FBQUQsQ0FBQyxBQTFDRCxJQTBDQyJ9