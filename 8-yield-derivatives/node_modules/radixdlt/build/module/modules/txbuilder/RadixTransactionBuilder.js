import { BehaviorSubject } from 'rxjs';
import { TSMap } from 'typescript-map';
import Decimal from 'decimal.js';
import BN from 'bn.js';
import { radixUniverse, RadixFeeProvider, RadixECIES, RadixParticleGroup, } from '../..';
import { RadixSpunParticle, RadixAtom, RadixMessageParticle, RadixTokenDefinitionParticle, RadixTokenPermissionsValues, RadixUnallocatedTokensParticle, RadixTransferrableTokensParticle, RadixUniqueParticle, RRI, RadixRRIParticle, } from '../atommodel';
import { logger } from '../common/RadixLogger';
import { RadixTokenDefinition, RadixTokenSupplyType } from '../token/RadixTokenDefinition';
export default class RadixTransactionBuilder {
    constructor() {
        this.BNZERO = new BN(0);
        this.DCZERO = new Decimal(0);
        this.participants = new TSMap();
        this.particleGroups = [];
    }
    getSubUnitsQuantity(decimalQuantity) {
        if (typeof decimalQuantity !== 'number' && typeof decimalQuantity !== 'string' && !Decimal.isDecimal(decimalQuantity)) {
            throw new Error('quantity is not a valid number');
        }
        const unitsQuantity = new Decimal(decimalQuantity);
        const subunitsQuantity = RadixTokenDefinition.fromDecimalToSubunits(unitsQuantity);
        return subunitsQuantity;
    }
    /**
     * Creates transfer atom
     * @param from Sender account, needs to have RadixAccountTransferSystem
     * @param to Receiver account
     * @param tokenReference TokenClassReference string
     * @param decimalQuantity
     * @param [message] Optional reference message
     */
    static createTransferAtom(from, to, tokenReference, decimalQuantity, message) {
        return new RadixTransactionBuilder().addTransfer(from, to, tokenReference, decimalQuantity, message);
    }
    /**
     * Creates transfer atom
     * @param from Sender account, needs to have RadixAccountTransferSystem
     * @param to Receiver account
     * @param tokenReferenceURI TokenClassReference string
     * @param decimalQuantity
     * @param [message] Optional reference message
     */
    addTransfer(from, to, tokenReference, decimalQuantity, message) {
        tokenReference = (tokenReference instanceof RRI)
            ? tokenReference
            : RRI.fromString(tokenReference);
        const subunitsQuantity = this.getSubUnitsQuantity(decimalQuantity);
        if (subunitsQuantity.lt(this.BNZERO)) {
            throw new Error('Negative quantity is not allowed');
        }
        else if (subunitsQuantity.eq(this.BNZERO)) {
            throw new Error(`Quantity 0 is not valid`);
        }
        const transferSytem = from.transferSystem;
        if (subunitsQuantity.gt(transferSytem.balance[tokenReference.toString()])) {
            throw new Error('Insufficient funds');
        }
        const unspentConsumables = transferSytem.getUnspentConsumables();
        const createTransferAtomParticleGroup = new RadixParticleGroup();
        const consumerQuantity = new BN(0);
        let granularity = new BN(1);
        let tokenPermissions;
        for (const consumable of unspentConsumables) {
            if (!consumable.getTokenDefinitionReference().equals(tokenReference)) {
                continue;
            }
            // Assumes all consumables of a token have the same granularity and permissions(enforced by core)
            granularity = consumable.getGranularity();
            tokenPermissions = consumable.getTokenPermissions();
            createTransferAtomParticleGroup.particles.push(RadixSpunParticle.down(consumable));
            consumerQuantity.iadd(consumable.getAmount());
            if (consumerQuantity.gte(subunitsQuantity)) {
                break;
            }
        }
        createTransferAtomParticleGroup.particles.push(RadixSpunParticle.up(new RadixTransferrableTokensParticle(subunitsQuantity, granularity, to.address, Date.now(), tokenReference, tokenPermissions)));
        // Remainder to myself
        if (consumerQuantity.sub(subunitsQuantity).gtn(0)) {
            createTransferAtomParticleGroup.particles.push(RadixSpunParticle.up(new RadixTransferrableTokensParticle(consumerQuantity.sub(subunitsQuantity), granularity, from.address, Date.now(), tokenReference, tokenPermissions)));
        }
        if (!subunitsQuantity.mod(granularity).eq(this.BNZERO)) {
            throw new Error(`This token requires that any tranferred amount is a multiple of it's granularity = 
                ${RadixTokenDefinition.fromSubunitsToDecimal(granularity)}`);
        }
        this.participants.set(from.getAddress(), from);
        this.participants.set(to.getAddress(), to);
        if (message) {
            this.addEncryptedMessage(from, 'transfer', message, [to, from]);
        }
        this.particleGroups.push(createTransferAtomParticleGroup);
        return this;
    }
    /**
     * Create an atom to burn a specified amount of tokens
     * ownerAccount must be the owner and the holder of the tokens to be burned
     *
     * @param  {RadixAccount} ownerAccount
     * @param  {string|RRI} tokenReference
     * @param  {string|number|Decimal} decimalQuantity
     */
    static createBurnAtom(ownerAccount, tokenReference, decimalQuantity) {
        return new this().burnTokens(ownerAccount, tokenReference, decimalQuantity);
    }
    /**
     * Create an atom to burn a specified amount of tokens
     * The token must be multi-issuance
     *
     * @param  {RadixAccount} ownerAccount must be the owner and the holder of the tokens to be burned
     * @param  {string|RRI} tokenReference
     * @param  {string|number|Decimal} decimalQuantity
     */
    burnTokens(ownerAccount, tokenReference, decimalQuantity) {
        tokenReference = (tokenReference instanceof RRI)
            ? tokenReference
            : RRI.fromString(tokenReference);
        const tokenClass = ownerAccount.tokenDefinitionSystem.getTokenDefinition(tokenReference.getName());
        const subunitsQuantity = this.getSubUnitsQuantity(decimalQuantity);
        if (subunitsQuantity.lt(this.BNZERO)) {
            throw new Error('Negative quantity is not allowed');
        }
        else if (subunitsQuantity.eq(this.BNZERO)) {
            throw new Error(`Quantity 0 is not valid`);
        }
        const transferSytem = ownerAccount.transferSystem;
        if (tokenClass.tokenSupplyType !== RadixTokenSupplyType.MUTABLE) {
            throw new Error('This token is fixed supply');
        }
        if (subunitsQuantity.gt(transferSytem.balance[tokenReference.toString()])) {
            throw new Error('Insufficient funds');
        }
        if (!subunitsQuantity.mod(tokenClass.getGranularity()).eq(this.BNZERO)) {
            throw new Error(`This token requires that any tranferred amount is a multiple of it's granularity = 
                ${RadixTokenDefinition.fromSubunitsToDecimal(tokenClass.getGranularity())}`);
        }
        const unspentConsumables = transferSytem.getUnspentConsumables();
        const burnParticleGroup = new RadixParticleGroup();
        const consumerQuantity = new BN(0);
        let tokenPermissions;
        for (const consumable of unspentConsumables) {
            if (!consumable.getTokenDefinitionReference().equals(tokenReference)) {
                continue;
            }
            burnParticleGroup.particles.push(RadixSpunParticle.down(consumable));
            tokenPermissions = consumable.getTokenPermissions();
            consumerQuantity.iadd(consumable.getAmount());
            if (consumerQuantity.gte(subunitsQuantity)) {
                break;
            }
        }
        burnParticleGroup.particles.push(RadixSpunParticle.up(new RadixUnallocatedTokensParticle(subunitsQuantity, tokenClass.getGranularity(), Date.now(), tokenReference, tokenPermissions)));
        // Remainder to myself
        if (consumerQuantity.sub(subunitsQuantity).gtn(0)) {
            burnParticleGroup.particles.push(RadixSpunParticle.up(new RadixTransferrableTokensParticle(consumerQuantity.sub(subunitsQuantity), tokenClass.getGranularity(), ownerAccount.address, Date.now(), tokenReference, tokenPermissions)));
        }
        this.particleGroups.push(burnParticleGroup);
        this.participants.set(ownerAccount.getAddress(), ownerAccount);
        return this;
    }
    /**
     * Create an atom to mint a specified amount of tokens
     * The token must be multi-issuance
     *
     * @param  {RadixAccount} ownerAccount must be the owner of the token
     * @param  {string|RRI} tokenReference
     * @param  {string|number|Decimal} decimalQuantity
     */
    static createMintAtom(ownerAccount, tokenReference, decimalQuantity) {
        return new this().mintTokens(ownerAccount, tokenReference, decimalQuantity);
    }
    /**
     * Create an atom to mint a specified amount of tokens
     * The token must be multi-issuance
     *
     * @param  {RadixAccount} ownerAccount must be the owner of the token
     * @param  {string|RRI} tokenReference
     * @param  {string|number|Decimal} decimalQuantity
     */
    mintTokens(ownerAccount, tokenReference, decimalQuantity) {
        tokenReference = (tokenReference instanceof RRI)
            ? tokenReference
            : RRI.fromString(tokenReference);
        const tokenClass = ownerAccount.tokenDefinitionSystem.getTokenDefinition(tokenReference.getName());
        const subunitsQuantity = this.getSubUnitsQuantity(decimalQuantity);
        if (subunitsQuantity.lt(this.BNZERO)) {
            throw new Error('Negative quantity is not allowed');
        }
        else if (subunitsQuantity.eq(this.BNZERO)) {
            throw new Error(`Quantity 0 is not valid`);
        }
        if (tokenClass.tokenSupplyType !== RadixTokenSupplyType.MUTABLE) {
            throw new Error('This token is fixed supply');
        }
        if (subunitsQuantity.gte(tokenClass.getUnallocatedSupply())) {
            throw new Error('Total supply would exceed 2^256');
        }
        if (!subunitsQuantity.mod(tokenClass.getGranularity()).eq(this.BNZERO)) {
            throw new Error(`This token requires that any tranferred amount is a multiple of it's granularity = 
                ${RadixTokenDefinition.fromSubunitsToDecimal(tokenClass.getGranularity())}`);
        }
        this.participants.set(ownerAccount.getAddress(), ownerAccount);
        const unallocatedTokens = tokenClass.getUnallocatedTokens();
        const tokenPermissions = unallocatedTokens[0].getTokenPermissions();
        const particleGroup = new RadixParticleGroup();
        const consumerQuantity = new BN(0);
        for (const consumable of unallocatedTokens) {
            particleGroup.particles.push(RadixSpunParticle.down(consumable));
            consumerQuantity.iadd(consumable.getAmount());
            if (consumerQuantity.gte(subunitsQuantity)) {
                break;
            }
        }
        // Remainder
        if (consumerQuantity.sub(subunitsQuantity).gtn(0)) {
            particleGroup.particles.push(RadixSpunParticle.up(new RadixUnallocatedTokensParticle(consumerQuantity.sub(subunitsQuantity), tokenClass.getGranularity(), Date.now(), tokenReference, tokenPermissions)));
        }
        const particle = new RadixTransferrableTokensParticle(subunitsQuantity, tokenClass.getGranularity(), ownerAccount.address, Date.now(), tokenReference, tokenPermissions);
        particleGroup.particles.push(RadixSpunParticle.up(particle));
        this.particleGroups.push(particleGroup);
        return this;
    }
    createToken(owner, name, symbol, description, granularity, decimalQuantity, iconUrl, permissions) {
        const tokenAmount = this.getSubUnitsQuantity(decimalQuantity);
        const tokenGranularity = this.getSubUnitsQuantity(granularity);
        if (tokenAmount.lt(this.BNZERO)) {
            throw new Error('Negative quantity is not allowed');
        }
        this.participants.set(owner.getAddress(), owner);
        const tokenClassParticle = new RadixTokenDefinitionParticle(owner.address, name, symbol, description, tokenGranularity, iconUrl, permissions);
        const rriParticle = new RadixRRIParticle(tokenClassParticle.getRRI());
        const initialSupplyParticle = new RadixUnallocatedTokensParticle(new BN(2).pow(new BN(256)).subn(1), tokenGranularity, Date.now(), tokenClassParticle.getTokenDefinitionReference(), permissions);
        const createTokenParticleGroup = new RadixParticleGroup([
            RadixSpunParticle.down(rriParticle),
            RadixSpunParticle.up(tokenClassParticle),
            RadixSpunParticle.up(initialSupplyParticle),
        ]);
        this.particleGroups.push(createTokenParticleGroup);
        if (tokenAmount.gtn(0)) {
            const mintParticle = new RadixTransferrableTokensParticle(tokenAmount, tokenGranularity, owner.address, Date.now(), tokenClassParticle.getTokenDefinitionReference(), permissions);
            const mintParticleGroup = new RadixParticleGroup([
                RadixSpunParticle.down(initialSupplyParticle),
                RadixSpunParticle.up(mintParticle),
            ]);
            const remainder = initialSupplyParticle.getAmount().sub(mintParticle.getAmount());
            if (remainder.gten(0)) {
                // Remainder
                const remainingSupplyParticle = new RadixUnallocatedTokensParticle(remainder, tokenGranularity, Date.now(), tokenClassParticle.getTokenDefinitionReference(), permissions);
                mintParticleGroup.particles.push(RadixSpunParticle.up(remainingSupplyParticle));
            }
            this.particleGroups.push(mintParticleGroup);
        }
        return this;
    }
    createTokenSingleIssuance(owner, name, symbol, description, granularity = new Decimal('1e-18'), amount, iconUrl) {
        const permissions = {
            mint: RadixTokenPermissionsValues.TOKEN_CREATION_ONLY,
            burn: RadixTokenPermissionsValues.TOKEN_CREATION_ONLY,
        };
        if (new Decimal(amount).eq(0)) {
            throw new Error('Single-issuance tokens cannot have an amount of 0');
        }
        return this.createToken(owner, name, symbol, description, granularity, amount, iconUrl, permissions);
    }
    createTokenMultiIssuance(owner, name, symbol, description, granularity = new Decimal('1e-18'), amount, iconUrl) {
        const permissions = {
            mint: RadixTokenPermissionsValues.TOKEN_OWNER_ONLY,
            burn: RadixTokenPermissionsValues.TOKEN_OWNER_ONLY,
        };
        return this.createToken(owner, name, symbol, description, granularity, amount, iconUrl, permissions);
    }
    /**
     * Creates payload atom
     * @param from
     * @param recipients Everyone who will receive and be able to decrypt the message
     * @param applicationId
     * @param payload
     * @param [encrypted] Sets if the message should be encrypted using ECIES
     */
    static createPayloadAtom(from, recipients, applicationId, payload, encrypted = true) {
        if (encrypted) {
            return new RadixTransactionBuilder().addEncryptedMessage(from, applicationId, payload, recipients);
        }
        else {
            return new RadixTransactionBuilder().addUnencryptedMessage(from, applicationId, payload, recipients);
        }
    }
    /**
     * Creates radix messaging application payload atom
     * @param from
     * @param to
     * @param message
     */
    static createRadixMessageAtom(from, to, message) {
        return new RadixTransactionBuilder().addEncryptedMessage(from, 'message', message, [from, to]);
    }
    addEncryptedMessage(from, applicationId, message, recipients) {
        const recipientPubKeys = recipients.map(r => r.address.getPublic());
        const { protectors, ciphertext } = RadixECIES.encryptForMultiple(recipientPubKeys, Buffer.from(message));
        this.addMessageParticle(from, ciphertext, {
            application: applicationId,
        }, recipients);
        this.addMessageParticle(from, JSON.stringify(protectors.map(p => p.toString('base64'))), {
            application: 'encryptor',
            contentType: 'application/json',
        }, recipients);
        return this;
    }
    addUnencryptedMessage(from, applicationId, message, recipients) {
        this.addMessageParticle(from, message, {
            application: applicationId,
        }, recipients);
        return this;
    }
    addMessageParticle(from, data, metadata, recipients) {
        for (const recipient of recipients) {
            this.participants.set(recipient.getAddress(), recipient);
        }
        const particle = new RadixMessageParticle(from.address, (recipients.length === 1) ? recipients[0].address : recipients[1].address, data, metadata);
        const particleParticleGroup = new RadixParticleGroup([RadixSpunParticle.up(particle)]);
        this.particleGroups.push(particleParticleGroup);
        return this;
    }
    /**
     * Add a particle which enforces that only one such particle can exists per account,
     * enforced on the ledger level
     *
     * @param  {RadixAccount} account Scope of the uniqueness constraint
     * @param  {string} unique The unique id
     */
    addUniqueParticle(account, unique) {
        const uniqueParticle = new RadixUniqueParticle(account.address, unique);
        const rriParticle = new RadixRRIParticle(uniqueParticle.getRRI());
        const uniqueParticleGroup = new RadixParticleGroup([
            RadixSpunParticle.down(rriParticle),
            RadixSpunParticle.up(uniqueParticle),
        ]);
        this.particleGroups.push(uniqueParticleGroup);
        return this;
    }
    /**
     * Builds the atom, finds a node to submit to, adds network fee, signs the atom and submits
     * @param signer
     * @returns a BehaviourSubject that streams the atom status updates
     */
    signAndSubmit(signer) {
        const atom = this.buildAtom();
        const stateSubject = new BehaviorSubject('FINDING_NODE');
        // Find a shard, any of the participant shards is ok
        const shard = atom.getShards()[0];
        // Get node from universe
        radixUniverse.getNodeConnection(shard)
            .then(connection => {
            RadixTransactionBuilder.signAndSubmitAtom(atom, connection, signer, this.participants.values())
                .subscribe(stateSubject);
        });
        return stateSubject;
    }
    buildAtom() {
        if (this.particleGroups.length === 0) {
            throw new Error('No particle groups specified');
        }
        const atom = new RadixAtom();
        atom.particleGroups = this.particleGroups;
        // Add timestamp
        atom.setTimestamp(Date.now());
        return atom;
    }
    static signAndSubmitAtom(atom, connection, signer, participants) {
        let signedAtom = null;
        // Add POW fee
        const stateSubject = new BehaviorSubject('GENERATING_POW');
        atom.clearPowNonce();
        RadixFeeProvider.generatePOWFee(radixUniverse.universeConfig.getMagic(), atom).then(pow => {
            atom.setPowNonce(pow.nonce);
            // Sign atom
            stateSubject.next('SIGNING');
            return signer.signAtom(atom);
        }).then(_signedAtom => {
            signedAtom = _signedAtom;
            // Push atom into participant accounts to minimize delay
            for (const participant of participants) {
                participant._onAtomReceived({
                    action: 'STORE',
                    atom: signedAtom,
                    processedData: {},
                    isHead: true,
                });
            }
            const submissionSubject = connection.submitAtom(signedAtom);
            submissionSubject.subscribe(stateSubject);
            submissionSubject.subscribe({
                error: error => {
                    logger.info('Problem submitting atom, deleting', error);
                    // Delete atom from participant accounts
                    for (const participant of participants) {
                        participant._onAtomReceived({
                            action: 'DELETE',
                            atom: signedAtom,
                            processedData: {},
                            isHead: true,
                        });
                    }
                }
            });
        }).catch(error => {
            stateSubject.error(error);
        });
        return stateSubject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhUcmFuc2FjdGlvbkJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy90eGJ1aWxkZXIvUmFkaXhUcmFuc2FjdGlvbkJ1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQTtBQUN0QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFHdEMsT0FBTyxPQUFPLE1BQU0sWUFBWSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxNQUFNLE9BQU8sQ0FBQTtBQUV0QixPQUFPLEVBQ0gsYUFBYSxFQUliLGdCQUFnQixFQUdoQixVQUFVLEVBQ1Ysa0JBQWtCLEdBQ3JCLE1BQU0sT0FBTyxDQUFBO0FBRWQsT0FBTyxFQUVILGlCQUFpQixFQUNqQixTQUFTLEVBQ1Qsb0JBQW9CLEVBRXBCLDRCQUE0QixFQUU1QiwyQkFBMkIsRUFDM0IsOEJBQThCLEVBQzlCLGdDQUFnQyxFQUNoQyxtQkFBbUIsRUFDbkIsR0FBRyxFQUNILGdCQUFnQixHQUNuQixNQUFNLGNBQWMsQ0FBQTtBQUVyQixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFDOUMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFFMUYsTUFBTSxDQUFDLE9BQU8sT0FBTyx1QkFBdUI7SUFBNUM7UUFDWSxXQUFNLEdBQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsV0FBTSxHQUFZLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRWhDLGlCQUFZLEdBQWdDLElBQUksS0FBSyxFQUFFLENBQUE7UUFFdkQsbUJBQWMsR0FBeUIsRUFBRSxDQUFBO0lBMnFCckQsQ0FBQztJQXpxQlcsbUJBQW1CLENBQUMsZUFBOEI7UUFDdEQsSUFBSSxPQUFPLGVBQWUsS0FBSyxR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