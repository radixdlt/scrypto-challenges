import { TSMap } from 'typescript-map';
import { Subject, Observable } from 'rxjs';
import { filter } from 'rxjs/operators';
import { RadixTokenDefinition, RadixTokenSupplyType } from '../token/RadixTokenDefinition';
import { RadixSpin, RadixTokenPermissionsValues, RadixUnallocatedTokensParticle, RadixTokenDefinitionParticle, RadixTransferrableTokensParticle, } from '../atommodel';
export class RadixTokenDefinitionAccountSystem {
    constructor(address) {
        this.address = address;
        this.name = 'TOKENS';
        this.tokenDefinitions = new TSMap();
        this.tokenDefinitionSubject = new Subject();
        this.processedAtomHIDs = new TSMap();
        // Empty constructor
    }
    processAtomUpdate(atomUpdate) {
        if (!atomUpdate.atom.containsParticle(RadixTokenDefinitionParticle, RadixUnallocatedTokensParticle)) {
            return;
        }
        if (atomUpdate.action === 'STORE') {
            this.processStoreAtom(atomUpdate);
        }
        else if (atomUpdate.action === 'DELETE') {
            this.processDeleteAtom(atomUpdate);
        }
    }
    processStoreAtom(atomUpdate) {
        const atom = atomUpdate.atom;
        if (this.processedAtomHIDs.has(atom.getAidString())) {
            return;
        }
        this.processedAtomHIDs.set(atom.getAidString(), true);
        for (const particleGroup of atom.getParticleGroups()) {
            let tokenDefinition;
            if (particleGroup.containsParticle(RadixTokenDefinitionParticle)) {
                // Token definition
                for (const spunParticle of particleGroup.getParticles()) {
                    if (spunParticle.particle instanceof RadixTokenDefinitionParticle && spunParticle.spin === RadixSpin.UP) {
                        this.createOrUpdateTokenDefinition(spunParticle.particle);
                    }
                    else if (spunParticle.particle instanceof RadixUnallocatedTokensParticle) {
                        const particle = spunParticle.particle;
                        tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                        if (spunParticle.spin === RadixSpin.UP) {
                            tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                        }
                        else {
                            tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                        }
                    }
                }
            }
            else if (particleGroup.containsParticle(RadixUnallocatedTokensParticle)
                && particleGroup.containsParticle(RadixTransferrableTokensParticle)) {
                // Mint or burn
                for (const spunParticle of particleGroup.getParticles()) {
                    if (spunParticle.particle instanceof RadixUnallocatedTokensParticle) {
                        const particle = spunParticle.particle;
                        tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                        if (spunParticle.spin === RadixSpin.UP) {
                            tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                            tokenDefinition.addTotalSupply(particle.getAmount().neg());
                        }
                        else {
                            tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                            tokenDefinition.addTotalSupply(particle.getAmount());
                        }
                    }
                }
            }
            if (tokenDefinition) {
                this.tokenDefinitionSubject.next(tokenDefinition);
            }
        }
    }
    processDeleteAtom(atomUpdate) {
        const atom = atomUpdate.atom;
        if (!this.processedAtomHIDs.has(atom.getAidString())) {
            return;
        }
        this.processedAtomHIDs.delete(atom.getAidString());
        for (const particleGroup of atom.getParticleGroups()) {
            let tokenDefinition;
            if (particleGroup.containsParticle(RadixTokenDefinitionParticle)) {
                // Token definition
                for (const spunParticle of particleGroup.getParticles()) {
                    if (spunParticle.particle instanceof RadixTokenDefinitionParticle && spunParticle.spin === RadixSpin.DOWN) {
                        this.createOrUpdateTokenDefinition(spunParticle.particle);
                    }
                    else if (spunParticle.particle instanceof RadixUnallocatedTokensParticle) {
                        const particle = spunParticle.particle;
                        tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                        if (spunParticle.spin === RadixSpin.DOWN) {
                            tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                        }
                        else {
                            tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                        }
                    }
                }
            }
            else if (particleGroup.containsParticle(RadixUnallocatedTokensParticle)
                && particleGroup.containsParticle(RadixTransferrableTokensParticle)) {
                // Mint or burn
                for (const spunParticle of particleGroup.getParticles()) {
                    if (spunParticle.particle instanceof RadixUnallocatedTokensParticle) {
                        const particle = spunParticle.particle;
                        tokenDefinition = this.getOrCreateTokenDefinition(particle.getTokenDefinitionReference());
                        if (spunParticle.spin === RadixSpin.DOWN) {
                            tokenDefinition.unallocatedTokens.set(particle.getHidString(), particle);
                            tokenDefinition.addTotalSupply(particle.getAmount().neg());
                        }
                        else {
                            tokenDefinition.unallocatedTokens.delete(particle.getHidString());
                            tokenDefinition.addTotalSupply(particle.getAmount());
                        }
                    }
                }
            }
            if (tokenDefinition) {
                this.tokenDefinitionSubject.next(tokenDefinition);
            }
        }
    }
    createOrUpdateTokenDefinition(particle) {
        const reference = particle.getTokenDefinitionReference();
        const tokenDefinition = this.getOrCreateTokenDefinition(reference);
        tokenDefinition.symbol = reference.getName();
        tokenDefinition.name = particle.name;
        tokenDefinition.description = particle.description;
        tokenDefinition.granularity = particle.granularity;
        tokenDefinition.iconUrl = particle.iconUrl;
        const mintPermissions = particle.permissions.mint;
        if (mintPermissions === RadixTokenPermissionsValues.TOKEN_CREATION_ONLY || mintPermissions === RadixTokenPermissionsValues.NONE) {
            tokenDefinition.tokenSupplyType = RadixTokenSupplyType.FIXED;
        }
        else if (mintPermissions === RadixTokenPermissionsValues.TOKEN_OWNER_ONLY || mintPermissions === RadixTokenPermissionsValues.ALL) {
            tokenDefinition.tokenSupplyType = RadixTokenSupplyType.MUTABLE;
        }
        else {
            throw new Error(`Token particle with MINT permissions ${mintPermissions} not supported`);
        }
        this.tokenDefinitionSubject.next(tokenDefinition);
    }
    getOrCreateTokenDefinition(reference) {
        if (!this.tokenDefinitions.has(reference.getName())) {
            this.tokenDefinitions.set(reference.getName(), new RadixTokenDefinition(reference.address, reference.getName()));
        }
        return this.tokenDefinitions.get(reference.getName());
    }
    getTokenDefinition(symbol) {
        if (this.tokenDefinitions.has(symbol)) {
            return this.tokenDefinitions.get(symbol);
        }
        return null;
    }
    // Subscribe for symbol
    getTokenDefinitionObservable(symbol) {
        return Observable.create((observer) => {
            if (this.tokenDefinitions.has(symbol)) {
                observer.next(this.tokenDefinitions.get(symbol));
            }
            this.tokenDefinitionSubject
                .pipe(filter(x => x.symbol === symbol))
                .subscribe(observer);
        });
    }
    getAllTokenDefinitionObservable() {
        return this.tokenDefinitionSubject.share();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkaXhUb2tlbkRlZmluaXRpb25BY2NvdW50U3lzdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvYWNjb3VudC9SYWRpeFRva2VuRGVmaW5pdGlvbkFjY291bnRTeXN0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3RDLE9BQU8sRUFBRSxPQUFPLEVBQU0sVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFBO0FBQzlDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUt2QyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQTtBQUMxRixPQUFPLEVBQ0gsU0FBUyxFQUVULDJCQUEyQixFQUMzQiw4QkFBOEIsRUFFOUIsNEJBQTRCLEVBQzVCLGdDQUFnQyxHQUNuQyxNQUFNLGNBQWMsQ0FBQTtBQUVyQixNQUFNLE9BQU8saUNBQWlDO0lBUzFDLFlBQXFCLE9BQXFCO1FBQXJCLFlBQU8sR0FBUCxPQUFPLENBQWM7UUFSbkMsU0FBSSxHQUFHLFFBQVEsQ0FBQTtRQUVmLHFCQUFnQixHQUFHLElBQUksS0FBSyxFQUFnQyxDQUFBO1FBRTNELDJCQUFzQixHQUFrQyxJQUFJLE9BQU8sRUFBRSxDQUFBO1FBQ3JFLHNCQUFpQixHQUFHLElBQUksS0FBSyxFQUFtQixDQUFBO1FBSXBELG9CQUFvQjtJQUN4QixDQUFDO0lBRU0saUJBQWlCLENBQUMsVUFBMkI7UUFDaEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNEJBQTRCLEVBQUUsOEJBQThCLENBQUMsRUFBRTtZQUNqRyxPQUFNO1NBQ1Q7UUFFRCxJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO1lBQy9CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQTtT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